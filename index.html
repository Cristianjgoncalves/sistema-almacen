<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Geminis v78</title><script src="https://cdn.tailwindcss.com"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"><style>@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');body{font-family:'Inter',sans-serif;background:#f3f4f6;overflow:hidden}::-webkit-scrollbar{width:8px}::-webkit-scrollbar-thumb{background:#3b82f6;border-radius:10px}.btn-pago{border:2px solid #e5e7eb;transition:0.2s;cursor:pointer;border-radius:1.5rem;padding:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;height:75px}.active-efectivo{border-color:#22c55e!important;background:#f0fdf4!important}.active-transferencia{border-color:#3b82f6!important;background:#eff6ff!important}.active-tarjeta{border-color:#ef4444!important;background:#fef2f2!important}.active-fiado{border-color:#f59e0b!important;background:#fffbeb!important}.input-cantidad{width:100px;height:45px;border:2px solid #3b82f6;text-align:center;font-weight:900;border-radius:12px;outline:none}</style></head><body class="h-screen flex"><div id="login-screen" class="fixed inset-0 bg-blue-600 z-[200] flex items-center justify-center p-4"><div class="bg-white p-10 rounded-[3rem] shadow-2xl w-full max-w-md text-center"><h2 class="text-3xl font-black mb-6 italic uppercase">Geminis</h2><div class="space-y-4"><input type="text" id="user-input" placeholder="USUARIO" class="w-full p-4 bg-gray-50 border-2 rounded-2xl font-black text-center outline-none focus:border-blue-500"><input type="password" id="pass-login" placeholder="CONTRASEÑA" class="w-full p-4 bg-gray-50 border-2 rounded-2xl font-black text-center outline-none focus:border-blue-500"><button onclick="intentarLogin()" class="w-full bg-blue-600 text-white py-5 rounded-[2rem] font-black uppercase shadow-xl hover:bg-blue-700 transition-all">Entrar</button></div></div></div><div id="sidebar" class="hidden w-72 bg-white shadow-xl flex flex-col z-20 border-r"><div class="p-6 border-b text-center"><img id="app-logo" src="OIP.webp" class="mx-auto mb-4 w-32 h-32 rounded-full shadow-lg object-cover"><h1 class="text-2xl font-black text-blue-600 uppercase italic">Geminis</h1><p id="ui-nombre-local" class="text-[10px] font-bold text-gray-400 uppercase italic"></p></div><nav class="flex-1 px-4 py-4 space-y-1 overflow-y-auto"><button onclick="showSection('pos')" class="w-full flex items-center p-4 hover:bg-blue-50 rounded-2xl font-bold text-gray-600"><i class="fas fa-cash-register mr-3 text-blue-500"></i> Ventas</button><button id="nav-inventory" onclick="showSection('inventory')" class="w-full flex items-center p-4 hover:bg-blue-50 rounded-2xl font-bold text-gray-600 hidden"><i class="fas fa-boxes mr-3 text-blue-500"></i> Inventario</button><button id="nav-reports" onclick="showSection('reports')" class="w-full flex items-center p-4 hover:bg-blue-50 rounded-2xl font-bold text-gray-600 hidden"><i class="fas fa-file-invoice-dollar mr-3 text-blue-500"></i> Auditoría</button><button onclick="showSection('totals')" class="w-full flex items-center p-4 hover:bg-blue-50 rounded-2xl font-bold text-gray-600"><i class="fas fa-chart-line mr-3 text-blue-500"></i> Totales Diarios</button><button onclick="showSection('accounts')" class="w-full flex items-center p-4 hover:bg-blue-50 rounded-2xl font-bold text-gray-600"><i class="fas fa-user-clock mr-3 text-orange-500"></i> Cta. Corriente</button><button onclick="showSection('weekly')" class="w-full flex items-center p-4 hover:bg-blue-50 rounded-2xl font-bold text-gray-600"><i class="fas fa-list-ol mr-3 text-yellow-500"></i> Prod. Semanal</button><button id="nav-config" onclick="showSection('config')" class="w-full flex items-center p-4 hover:bg-blue-50 rounded-2xl font-bold text-gray-600 hidden"><i class="fas fa-cog mr-3 text-gray-500"></i> Configuración</button></nav><div class="p-4 border-t text-center"><button onclick="location.reload()" class="text-[10px] font-black text-red-400 uppercase">Salir</button><div id="reloj" class="text-[10px] font-black text-blue-900 mt-2"></div></div></div><div id="main-area" class="hidden flex-1 flex flex-col overflow-hidden text-center"><header class="bg-white p-6 shadow-sm border-b flex justify-center"><input type="text" id="buscador" onkeyup="filtrarProductos()" placeholder="Buscar en Geminis..." class="w-full max-w-lg p-3 border-2 rounded-2xl font-bold text-center bg-gray-50 outline-none focus:border-blue-500"></header><main id="main-content" class="flex-1 p-8 overflow-y-auto text-center"></main></div><script>let currentUserRole="",productos=JSON.parse(localStorage.getItem('productos'))||[],historialVentas=JSON.parse(localStorage.getItem('historial_ventas'))||[],gastos=JSON.parse(localStorage.getItem('gastos'))||[],cuentasCorrientes=JSON.parse(localStorage.getItem('cuentas_corrientes'))||{},cajasIniciales=JSON.parse(localStorage.getItem('cajas_iniciales'))||{},logoGuardado=localStorage.getItem('app_logo_base64')||"OIP.webp",configNegocio=JSON.parse(localStorage.getItem('config_negocio'))||{nombre:"EL ALMACEN",dir1:"",dir2:"",tel:"",ig:"",fb:""},carrito=[],filtroActual="",metodoActual="Efectivo";const fmtNum=n=>parseFloat(parseFloat(n).toFixed(3));function intentarLogin(){const u=document.getElementById('user-input').value,p=document.getElementById('pass-login').value;if(u==="admin"&&(p==="Mupirata1"||p==="12345")){currentUserRole=(p==="Mupirata1")?"admin":"staff";entrarAlPrograma()}else alert("Error")}function entrarAlPrograma(){document.getElementById('login-screen').classList.add('hidden');document.getElementById('sidebar').classList.remove('hidden');document.getElementById('main-area').classList.remove('hidden');const a=currentUserRole==="admin";document.getElementById('nav-inventory').classList.toggle('hidden',!a);document.getElementById('nav-reports').classList.toggle('hidden',!a);document.getElementById('nav-config').classList.toggle('hidden',!a);document.getElementById('ui-nombre-local').innerText=configNegocio.nombre;document.getElementById('app-logo').src=logoGuardado;showSection('pos')}function showSection(n){const c=document.getElementById('main-content');if(n==='pos')renderPOS(c);if(n==='inventory')renderInventory(c);if(n==='reports')renderReports(c);if(n==='totals')renderDailyTotals(c);if(n==='accounts')renderAccounts(c);if(n==='weekly')renderWeeklyRanking(c);if(n==='config')renderConfig(c)}function renderPOS(c){const f=productos.filter(p=>p.nombre.toLowerCase().includes(filtroActual));c.innerHTML=`<div class="flex gap-8 h-full"><div class="flex-1 grid grid-cols-3 gap-4 content-start overflow-y-auto">${f.map(p=>`<div onclick="addCar(${p.id})" class="bg-white p-5 rounded-3xl border-2 hover:border-blue-400 cursor-pointer text-center h-fit"><h3 class="font-black text-[10px] uppercase">${p.nombre}</h3><p class="text-2xl font-black">$${p.precio}</p><p class="text-[9px] text-gray-300 italic">Stock: ${p.stock}</p></div>`).join('')}</div><div class="w-[450px] bg-white rounded-[3rem] shadow-2xl p-8 flex flex-col border"><div id="cart-list" class="flex-1 overflow-y-auto space-y-3"></div><div class="pt-6 border-t-2 border-dashed mt-auto"><div class="flex justify-between items-center mb-6"><span class="font-black uppercase text-gray-400">Total</span><span id="total-txt" class="text-5xl font-black text-blue-900">$0</span></div><div class="grid grid-cols-4 gap-2 mb-6"><button onclick="setMet('Efectivo')" id="btn-Efectivo" class="btn-pago active-efectivo"><i class="fas fa-money-bill-wave text-green-500"></i><span class="text-[8px] font-black uppercase">Efectivo</span></button><button onclick="setMet('Transferencia')" id="btn-Transferencia" class="btn-pago"><i class="fas fa-university text-blue-500"></i><span class="text-[8px] font-black uppercase">Transf.</span></button><button onclick="setMet('Tarjeta')" id="btn-Tarjeta" class="btn-pago"><i class="fas fa-credit-card text-red-500"></i><span class="text-[8px] font-black uppercase">Tarjeta</span></button><button onclick="setMet('Fiado')" id="btn-Fiado" class="btn-pago"><i class="fas fa-user-clock text-orange-500"></i><span class="text-[8px] font-black uppercase">Fiado</span></button></div><div class="grid grid-cols-2 gap-4"><button onclick="cobrar(true)" class="bg-blue-600 text-white py-5 rounded-[2rem] font-black shadow-lg uppercase text-xs">Ticket</button><button onclick="cobrar(false)" class="bg-gray-800 text-white py-5 rounded-[2rem] font-black shadow-lg uppercase text-xs">Cobrar</button></div></div></div></div>`;renderCart()}function addCar(id){const p=productos.find(x=>x.id===id);if(p.stock<=0)return alert("Sin Stock");const e=carrito.find(x=>x.id===id);if(e)e.cantidad=fmtNum(e.cantidad+1);else carrito.push({...p,cantidad:1});renderCart()}function renderCart(){const l=document.getElementById('cart-list');if(!l)return;l.innerHTML=carrito.map((i,x)=>`<div class="bg-white p-3 rounded-2xl border flex justify-between items-center"><div class="font-black text-[10px] uppercase truncate w-24">${i.nombre}</div><div class="flex items-center gap-2"><input type="number" step="0.001" value="${fmtNum(i.cantidad)}" onchange="carrito[${x}].cantidad=fmtNum(this.value);renderCart()" class="input-cantidad"><span class="font-black">$${fmtNum(i.precio*i.cantidad)}</span><button onclick="carrito.splice(${x},1);renderCart()" class="text-red-300 text-xl"><i class="fas fa-times-circle"></i></button></div></div>`).join('');document.getElementById('total-txt').innerText=`$${fmtNum(carrito.reduce((s,i)=>s+(i.precio*i.cantidad),0))}`}function setMet(m){metodoActual=m;document.querySelectorAll('.btn-pago').forEach(b=>b.classList.remove('active-efectivo','active-transferencia','active-tarjeta','active-fiado'));document.getElementById(`btn-${m}`).classList.add(`active-${m.toLowerCase()}`)}function cobrar(imp){if(!carrito.length)return;let cli="";if(metodoActual==='Fiado'){cli=prompt("NOMBRE DEL CLIENTE:");if(!cli)return;cli=cli.toUpperCase();cuentasCorrientes[cli]=fmtNum((cuentasCorrientes[cli]||0)+carrito.reduce((s,i)=>s+(i.precio*i.cantidad),0));localStorage.setItem('cuentas_corrientes',JSON.stringify(cuentasCorrientes))}const t=carrito.reduce((s,i)=>s+(i.precio*i.cantidad),0);historialVentas.push({id:Date.now(),fecha:new Date().toLocaleDateString(),hora:new Date().toLocaleTimeString(),total:t,ganancia:carrito.reduce((s,i)=>s+(i.precio-i.costo)*i.cantidad,0),metodo:metodoActual,cliente:cli,itemsDetallados:carrito.map(i=>({id:i.id,nombre:i.nombre,cantidad:i.cantidad,precio:i.precio,costo:i.costo}))});carrito.forEach(item=>{const p=productos.find(x=>x.id===item.id);if(p)p.stock=fmtNum(p.stock-item.cantidad)});localStorage.setItem('historial_ventas',JSON.stringify(historialVentas));localStorage.setItem('productos',JSON.stringify(productos));if(imp)imprimirTicket(t,cli);carrito=[];metodoActual="Efectivo";showSection('pos')}function imprimirTicket(t,cli){const w=window.open('','_blank');w.document.write(`<html><body style="font-family:sans-serif;width:230px;text-align:center;"><img src="${logoGuardado}" style="width:70px;height:70px;border-radius:50%;"><br><b>${configNegocio.nombre}</b><hr><table style="width:100%;font-size:10px;text-align:left;">${carrito.map(i=>`<tr><td>${i.cantidad}</td><td>${i.nombre}</td><td>$${fmtNum(i.precio*i.cantidad)}</td></tr>`).join('')}</table><hr><b>TOTAL: $${fmtNum(t)}</b><br><span style="font-size:10px;">${metodoActual} ${cli||''}</span><hr><div style="font-size:9px;">${configNegocio.tel?'Tel:'+configNegocio.tel:''}<br>${configNegocio.ig?'IG:'+configNegocio.ig:''}<br>${configNegocio.fb?'FB:'+configNegocio.fb:''}<br>¡GRACIAS!</div><script>window.print();window.close();<\/script></body></html>`)}function renderDailyTotals(c){const r=historialVentas.reduce((a,v)=>{if(!a[v.fecha])a[v.fecha]={bruto:0,efectivo:0};a[v.fecha].bruto+=v.total;if(v.metodo==='Efectivo')a[v.fecha].efectivo+=v.total;return a},{});const hoy=new Date().toLocaleDateString();if(!r[hoy])r[hoy]={bruto:0,efectivo:0};c.innerHTML=`<h2 class="text-3xl font-black text-blue-600 mb-8 uppercase italic">Caja Diaria</h2><div class="space-y-6">${Object.keys(r).reverse().map(f=>{const gl=gastos.filter(g=>g.fecha===f),tg=gl.reduce((s,g)=>s+g.monto,0),ci=cajasIniciales[f]||0;return `<div class="bg-white p-8 rounded-[3rem] border shadow-sm"><div class="flex justify-between border-b pb-3 mb-6 font-black text-blue-900"><span>${f}</span></div><div class="grid grid-cols-4 gap-4"><div><p class="text-[9px] font-black text-gray-400 uppercase">Caja Inicial</p><input type="number" value="${ci}" onchange="gCI('${f}',this.value)" class="w-20 text-center font-black bg-gray-50 border-2 rounded-xl py-1"></div><div><p class="text-[9px] font-black text-gray-400 uppercase">Efectivo</p><p class="font-black text-xl">$${r[f].efectivo}</p></div><div><p class="text-[9px] font-black text-orange-400 uppercase">Gastos</p><p class="font-black text-xl text-orange-500">$${tg}</p><button onclick="addG('${f}')" class="text-[10px] font-black text-blue-500 underline uppercase">+ GASTO</button></div><div class="text-right"><p class="text-[9px] font-black text-gray-400 uppercase">Plata Real</p><p class="font-black text-green-600 text-3xl">$${fmtNum(ci+r[f].efectivo-tg)}</p></div></div><div class="mt-4 flex flex-wrap gap-2 justify-center text-[10px] font-bold">${gl.map(g=>`<span class="bg-orange-50 p-1 rounded-lg border">${g.desc}: $${g.monto} <i onclick="delG(${g.id})" class="fas fa-times cursor-pointer text-red-400"></i></span>`).join('')}</div></div>`}).join('')}</div>`}function addG(f){document.getElementById('buscador').blur();const d=prompt("CONCEPTO:"),m=parseFloat(prompt("MONTO $:"));if(d&&!isNaN(m)){gastos.push({id:Date.now(),fecha:f,desc:d.toUpperCase(),monto:m});localStorage.setItem('gastos',JSON.stringify(gastos));showSection('totals')}}function delG(id){if(confirm("Borrar?")){gastos=gastos.filter(g=>g.id!==id);localStorage.setItem('gastos',JSON.stringify(gastos));showSection('totals')}}function gCI(f,v){cajasIniciales[f]=parseFloat(v)||0;localStorage.setItem('cajas_iniciales',JSON.stringify(cajasIniciales));showSection('totals')}function renderAccounts(c){c.innerHTML=`<h2 class="text-3xl font-black text-orange-500 mb-8 uppercase italic">Cuentas Corrientes</h2><div class="grid grid-cols-3 gap-6">${Object.entries(cuentasCorrientes).map(([n,d])=>`<div class="bg-white p-8 rounded-[3rem] border shadow-sm text-center"><h3 class="font-black text-blue-900 text-xl">${n}</h3><p class="text-4xl font-black text-red-600 mb-6">$${fmtNum(d)}</p><button onclick="payAcc('${n}')" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black">ENTREGAR PAGO</button></div>`).join('')}</div>`}function payAcc(n){const p=parseFloat(prompt(`DEUDA DE ${n}: $${fmtNum(cuentasCorrientes[n])}\nCUANTO PAGA?`));if(!isNaN(p)){cuentasCorrientes[n]=fmtNum(cuentasCorrientes[n]-p);if(cuentasCorrientes[n]<0)cuentasCorrientes[n]=0;localStorage.setItem('cuentas_corrientes',JSON.stringify(cuentasCorrientes));showSection('accounts')}}function renderInventory(c){c.innerHTML=`<div class="bg-white p-10 rounded-[3rem] mb-10 border text-center"><div class="grid grid-cols-5 gap-4"><input type="text" id="i-n" placeholder="NOMBRE" class="p-4 border-2 rounded-2xl text-center"><input type="number" id="i-c" placeholder="COSTO" class="p-4 border-2 rounded-2xl text-center"><input type="number" id="i-p" placeholder="VENTA" class="p-4 border-2 rounded-2xl text-center"><input type="number" id="i-s" placeholder="STOCK" class="p-4 border-2 rounded-2xl text-center"><button onclick="saveP()" class="bg-blue-600 text-white rounded-2xl font-black">Agregar</button></div></div><div class="space-y-2 pb-10">${productos.map((p,idx)=>`<div class="bg-white p-4 rounded-2xl border flex justify-between items-center text-center"><div class="w-1/3 uppercase font-black truncate">${p.nombre}</div><div class="flex gap-4"><input type="number" value="${p.costo}" oninput="productos[${idx}].costo=this.value;localStorage.setItem('productos',JSON.stringify(productos))" class="w-20 text-center bg-orange-50 rounded-lg"><input type="number" value="${p.precio}" oninput="productos[${idx}].precio=this.value;localStorage.setItem('productos',JSON.stringify(productos))" class="w-20 text-center bg-blue-50 rounded-lg"><input type="number" value="${p.stock}" oninput="productos[${idx}].stock=this.value;localStorage.setItem('productos',JSON.stringify(productos))" class="w-20 text-center bg-gray-50 rounded-lg"><button onclick="productos.splice(${idx},1);localStorage.setItem('productos',JSON.stringify(productos));showSection('inventory')" class="text-red-300 text-2xl"><i class="fas fa-trash"></i></button></div></div>`).join('')}</div>`}function saveP(){const n=document.getElementById('i-n').value,c=parseFloat(document.getElementById('i-c').value)||0,p=parseFloat(document.getElementById('i-p').value)||0,s=parseFloat(document.getElementById('i-s').value)||0;if(n){productos.push({id:Date.now(),nombre:n.toUpperCase(),costo:c,precio:p,stock:s});localStorage.setItem('productos',JSON.stringify(productos));showSection('inventory')}}function renderReports(c){const dh=historialVentas.filter(v=>v.fecha===new Date().toLocaleDateString());c.innerHTML=`<h2 class="text-3xl font-black text-blue-600 mb-8 uppercase italic">Auditoría</h2><div class="space-y-3 pb-10">${dh.slice().reverse().map(v=>`<div class="p-5 rounded-[2rem] border-2 flex justify-between bg-white items-center"><div><p class="font-black">${v.hora} - ${v.metodo} ${v.cliente?`(${v.cliente})`:''}</p></div><span class="font-black text-xl">$${v.total}</span><button onclick="anulV(${v.id})" class="text-red-300 text-2xl"><i class="fas fa-trash-alt"></i></button></div>`).join('')}</div>`}function anulV(id){if(confirm("Anular?")){const v=historialVentas.find(x=>x.id===id);if(v.metodo==='Fiado')cuentasCorrientes[v.cliente]-=v.total;v.itemsDetallados.forEach(i=>{const p=productos.find(x=>x.id===i.id);if(p)p.stock=fmtNum(p.stock+i.cantidad)});historialVentas=historialVentas.filter(x=>x.id!==id);localStorage.setItem('historial_ventas',JSON.stringify(historialVentas));localStorage.setItem('productos',JSON.stringify(productos));showSection('reports')}}function renderConfig(c){c.innerHTML=`<div class="max-w-2xl mx-auto bg-white p-12 rounded-[3.5rem] border text-center"><h2 class="text-3xl font-black mb-10 text-blue-600 italic">Configuración</h2><div class="space-y-4"><input type="text" id="cfg-n" value="${configNegocio.nombre}" class="w-full p-4 border-2 rounded-2xl text-center"><div class="grid grid-cols-2 gap-4"><input type="text" id="cfg-d1" value="${configNegocio.dir1}" class="p-4 border-2 rounded-2xl text-center"><input type="text" id="cfg-d2" value="${configNegocio.dir2}" class="p-4 border-2 rounded-2xl text-center"></div><button onclick="saveCfg()" class="w-full bg-blue-600 text-white py-5 rounded-[2rem] font-black">Guardar</button><button onclick="expDat()" class="bg-gray-800 text-white w-full py-4 rounded-2xl">Respaldo</button></div></div>`}function saveCfg(){configNegocio.nombre=document.getElementById('cfg-n').value.toUpperCase();configNegocio.dir1=document.getElementById('cfg-d1').value;configNegocio.dir2=document.getElementById('cfg-d2').value;localStorage.setItem('config_negocio',JSON.stringify(configNegocio));location.reload()}function expDat(){const b=new Blob([JSON.stringify({productos,historialVentas,gastos,cajasIniciales,cuentasCorrientes,configNegocio,logo:logoGuardado})],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download=`Geminis_Data.json`;a.click()}function filtrarProductos(){filtroActual=document.getElementById('buscador').value.toLowerCase();showSection('pos')}function renderWeeklyRanking(c){const a=historialVentas.reduce((acc,v)=>{if(!acc[v.fecha])acc[v.fecha]={};if(v.itemsDetallados){v.itemsDetallados.forEach(i=>{if(!acc[v.fecha][i.nombre])acc[v.fecha][i.nombre]=0;acc[v.fecha][i.nombre]=fmtNum(acc[v.fecha][i.nombre]+i.cantidad)});}return acc},{});const fs=Object.keys(a).sort((x,y)=>new Date(y)-new Date(x)).slice(0,7);c.innerHTML=`<h2 class="text-3xl font-black text-blue-600 mb-8 uppercase italic text-center">Prod. Semanal</h2><div class="space-y-6">${fs.map(f=>`<div class="bg-white p-8 rounded-[3rem] border shadow-sm"><h3 class="font-black border-b mb-4 uppercase italic">${f}</h3><div class="grid grid-cols-4 gap-4">${Object.entries(a[f]).sort((x,y)=>y[1]-x[1]).map(([n,q])=>`<div class="bg-gray-50 p-4 rounded-2xl border text-center"><p class="text-[9px] font-black text-gray-400 uppercase truncate">${n}</p><p class="text-xl font-black text-gray-800">${q}</p></div>`).join('')}</div></div>`).join('')}</div>`}setInterval(()=>document.getElementById('reloj').innerText=new Date().toLocaleString(),1000);</script></body></html>

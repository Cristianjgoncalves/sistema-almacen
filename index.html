<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>El Almacén del Repostero v96</title><script src="https://cdn.tailwindcss.com"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"><style>@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');body{font-family:'Inter',sans-serif;background:#f3f4f6;overflow:hidden}::-webkit-scrollbar{width:8px}::-webkit-scrollbar-thumb{background:#3b82f6;border-radius:10px}.btn-pago{border:2px solid #e5e7eb;transition:0.2s;cursor:pointer;border-radius:1.5rem;padding:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;height:75px}.active-efectivo{border-color:#22c55e!important;background:#f0fdf4!important}.active-transferencia{border-color:#3b82f6!important;background:#eff6ff!important}.active-tarjeta{border-color:#ef4444!important;background:#fef2f2!important}.active-fiado{border-color:#f59e0b!important;background:#fffbeb!important}.input-cantidad{width:100px;height:45px;border:2px solid #3b82f6;text-align:center;font-weight:900;border-radius:12px;outline:none}.img-prod{width:100%;height:80px;object-fit:cover;border-radius:1rem;margin-bottom:5px}</style></head><body class="h-screen flex"><div id="login-screen" class="fixed inset-0 bg-blue-600 z-[200] flex items-center justify-center p-4"><div class="bg-white p-10 rounded-[3rem] shadow-2xl w-full max-w-md text-center"><h2 class="text-2xl font-black mb-6 italic uppercase text-blue-600">EL ALMACÉN DEL REPOSTERO</h2><div class="space-y-4"><input type="text" id="user-input" placeholder="USUARIO" class="w-full p-4 bg-gray-50 border-2 rounded-2xl font-black text-center outline-none focus:border-blue-500 uppercase"><input type="password" id="pass-login" placeholder="CONTRASEÑA" class="w-full p-4 bg-gray-50 border-2 rounded-2xl font-black text-center outline-none focus:border-blue-500"><button onclick="intentarLogin()" class="w-full bg-blue-600 text-white py-5 rounded-[2rem] font-black uppercase shadow-xl hover:bg-blue-700 transition-all text-xs font-black">Ingresar</button></div></div></div><div id="sidebar" class="hidden w-72 bg-white shadow-xl flex flex-col z-20 border-r text-center"><div class="p-6 border-b"><img id="app-logo" src="OIP.webp" class="mx-auto mb-4 w-32 h-32 rounded-full shadow-lg object-cover border-2 border-blue-100"><h1 class="text-xl font-black text-blue-600 uppercase italic leading-tight">EL ALMACÉN<br>DEL REPOSTERO</h1><p id="ui-nombre-local" class="text-[9px] font-bold text-gray-400 uppercase italic mt-1"></p></div><nav class="flex-1 px-4 py-4 space-y-1 overflow-y-auto"><button onclick="showSection('pos')" class="w-full flex items-center p-4 hover:bg-blue-50 rounded-2xl font-bold text-gray-600"><i class="fas fa-cash-register mr-3 text-blue-500"></i> Ventas</button><button onclick="showSection('pedidos')" class="w-full flex items-center p-4 hover:bg-blue-50 rounded-2xl font-bold text-gray-600"><i class="fas fa-clipboard-list mr-3 text-purple-500"></i> Pedidos</button><button id="nav-inventory" onclick="showSection('inventory')" class="w-full flex items-center p-4 hover:bg-blue-50 rounded-2xl font-bold text-gray-600 hidden"><i class="fas fa-boxes mr-3 text-blue-500"></i> Inventario</button><button id="nav-reports" onclick="showSection('reports')" class="w-full flex items-center p-4 hover:bg-blue-50 rounded-2xl font-bold text-gray-600 hidden"><i class="fas fa-file-invoice-dollar mr-3 text-blue-500"></i> Auditoría</button><button id="nav-ganancias" onclick="showSection('ganancias')" class="w-full flex items-center p-4 hover:bg-green-50 rounded-2xl font-bold text-gray-600 hidden"><i class="fas fa-hand-holding-usd mr-3 text-green-500"></i> Ganancias Reales</button><button onclick="showSection('totals')" class="w-full flex items-center p-4 hover:bg-blue-50 rounded-2xl font-bold text-gray-600"><i class="fas fa-chart-line mr-3 text-blue-500"></i> Totales Diarios</button><button onclick="showSection('accounts')" class="w-full flex items-center p-4 hover:bg-blue-50 rounded-2xl font-bold text-gray-600"><i class="fas fa-user-clock mr-3 text-orange-500"></i> Cta. Corriente</button><button onclick="showSection('weekly')" class="w-full flex items-center p-4 hover:bg-blue-50 rounded-2xl font-bold text-gray-600"><i class="fas fa-list-ol mr-3 text-yellow-500"></i> Prod. Semanal</button><button id="nav-config" onclick="showSection('config')" class="w-full flex items-center p-4 hover:bg-blue-50 rounded-2xl font-bold text-gray-600 hidden"><i class="fas fa-cog mr-3 text-gray-500"></i> Configuración</button></nav><div class="p-4 border-t text-center"><button onclick="location.reload()" class="text-[10px] font-black text-red-400 uppercase italic font-bold">Salir</button><div id="reloj" class="text-[10px] font-black text-blue-900 mt-2"></div></div></div><div id="main-area" class="hidden flex-1 flex flex-col overflow-hidden text-center"><header class="bg-white p-6 shadow-sm border-b flex justify-center"><input type="text" id="buscador" oninput="filtroActual=this.value.toLowerCase();actualizarVentas()" placeholder="¿Qué buscamos hoy?" class="w-full max-w-lg p-3 border-2 rounded-2xl font-bold text-center bg-gray-50 outline-none focus:border-blue-500 uppercase"></header><main id="main-content" class="flex-1 p-8 overflow-y-auto text-center"></main></div><script>let currentUserRole="",isOwner=false,productos=JSON.parse(localStorage.getItem('productos'))||[],historialVentas=JSON.parse(localStorage.getItem('historial_ventas'))||[],gastos=JSON.parse(localStorage.getItem('gastos'))||[],cuentasCorrientes=JSON.parse(localStorage.getItem('cuentas_corrientes'))||{},cajasIniciales=JSON.parse(localStorage.getItem('cajas_iniciales'))||{},pedidos=JSON.parse(localStorage.getItem('pedidos_repostero'))||[],logoGuardado=localStorage.getItem('app_logo_base64')||"OIP.webp",configNegocio=JSON.parse(localStorage.getItem('config_negocio'))||{nombre:"EL ALMACÉN DEL REPOSTERO",dir1:"Sarmiento 2201",dir2:"Marcos Paz",tel:"",ig:"",fb:""},carrito=[],filtroActual="",filtroInv="",metodoActual="Efectivo",tempImgProd="";const fmtNum=n=>parseFloat(parseFloat(n).toFixed(3));function intentarLogin(){const u=document.getElementById('user-input').value,p=document.getElementById('pass-login').value;if(u==="admin"&&(p==="Mupirata1"||p==="12345")){isOwner=(p==="Mupirata1");currentUserRole="admin";entrarAlPrograma()}else alert("Error")}function entrarAlPrograma(){document.getElementById('login-screen').classList.add('hidden');document.getElementById('sidebar').classList.remove('hidden');document.getElementById('main-area').classList.remove('hidden');if(isOwner){document.getElementById('nav-inventory').classList.remove('hidden');document.getElementById('nav-reports').classList.remove('hidden');document.getElementById('nav-ganancias').classList.remove('hidden');document.getElementById('nav-config').classList.remove('hidden')}document.getElementById('ui-nombre-local').innerText=configNegocio.nombre;document.getElementById('app-logo').src=logoGuardado;showSection('pos')}function showSection(n){const c=document.getElementById('main-content');if(n==='pos')renderPOS(c);else if(n==='pedidos')renderPedidos(c);else if(n==='inventory')renderInventory(c);else if(n==='reports')renderReports(c);else if(n==='totals')renderDailyTotals(c);else if(n==='accounts')renderAccounts(c);else if(n==='weekly')renderWeeklyRanking(c);else if(n==='config')renderConfig(c);else if(n==='ganancias')renderGanancias(c)}function calcVueltoVisual(){const t=carrito.reduce((s,i)=>s+(i.precio*i.cantidad),0);const pCon=parseFloat(document.getElementById('pago-con').value);const div=document.getElementById('vuelto-visual');if(!isNaN(pCon)&&pCon>=t){div.innerHTML=`Vuelto: $${fmtNum(pCon-t)}`;div.classList.remove('hidden')}else{div.innerHTML=``;div.classList.add('hidden')}}function renderPOS(c){c.innerHTML=`<div class="flex gap-8 h-full"><div id="lista-ventas" class="flex-1 grid grid-cols-3 gap-4 content-start overflow-y-auto"></div><div class="w-[450px] bg-white rounded-[3rem] shadow-2xl p-8 flex flex-col border"><div id="cart-list" class="flex-1 overflow-y-auto space-y-3"></div><div class="pt-6 border-t-2 border-dashed mt-auto"><div id="vuelto-visual" class="hidden bg-green-100 text-green-700 font-black py-2 rounded-xl mb-2 text-xl text-center shadow-inner"></div><div class="mb-4"><input type="number" id="pago-con" oninput="calcVueltoVisual()" placeholder="¿Paga con cuánto?" class="w-full p-2 border-2 rounded-xl text-center font-black outline-none focus:border-blue-500"></div><div id="fiado-nombre-div" class="hidden mb-4"><input type="text" id="fiado-cli" placeholder="NOMBRE DEL CLIENTE" class="w-full p-2 border-2 border-orange-400 rounded-xl text-center font-black uppercase"></div><div class="flex justify-between items-center mb-6 px-2"><span class="font-black uppercase text-gray-400 text-xs tracking-widest font-bold font-black">Total</span><span id="total-txt" class="text-5xl font-black text-blue-900">$0</span></div><div class="grid grid-cols-4 gap-2 mb-6"><button onclick="setMet('Efectivo')" id="btn-Efectivo" class="btn-pago active-efectivo font-black"><i class="fas fa-money-bill-wave text-green-500 font-black"></i><span class="text-[8px] font-black uppercase mt-1">Efectivo</span></button><button onclick="setMet('Transferencia')" id="btn-Transferencia" class="btn-pago font-black"><i class="fas fa-university text-blue-500 font-black"></i><span class="text-[8px] font-black uppercase mt-1">Transf.</span></button><button onclick="setMet('Tarjeta')" id="btn-Tarjeta" class="btn-pago font-black"><i class="fas fa-credit-card text-red-500 font-black"></i><span class="text-[8px] font-black uppercase mt-1">Tarjeta</span></button><button onclick="setMet('Fiado')" id="btn-Fiado" class="btn-pago font-black"><i class="fas fa-user-clock text-orange-500 font-black"></i><span class="text-[8px] font-black uppercase mt-1">Fiado</span></button></div><div class="grid grid-cols-2 gap-4"><button onclick="cobrar(true)" class="bg-blue-600 text-white py-5 rounded-[2rem] font-black shadow-lg uppercase text-xs">Ticket</button><button onclick="cobrar(false)" class="bg-gray-800 text-white py-5 rounded-[2rem] font-black shadow-lg uppercase text-xs">Cobrar</button></div></div></div></div>`;actualizarVentas();renderCart()}function actualizarVentas(){const f=productos.filter(p=>p.nombre.toLowerCase().includes(filtroActual));const l=document.getElementById('lista-ventas');if(!l)return;l.innerHTML=f.map(p=>`<div onclick="addCar(${p.id})" class="bg-white p-4 rounded-3xl border-2 hover:border-blue-400 cursor-pointer text-center h-fit shadow-sm">${p.img?`<img src="${p.img}" class="img-prod">`:`<div class="img-prod bg-gray-100 flex items-center justify-center text-gray-300"><i class="fas fa-cookie-bite text-2xl"></i></div>`}<h3 class="font-black text-[10px] uppercase truncate font-bold text-gray-700">${p.nombre}</h3><p class="text-xl font-black text-gray-900">$${p.precio}</p><p class="text-[9px] text-gray-300 italic font-bold">Stock: ${p.stock}</p></div>`).join('')}function addCar(id){const p=productos.find(x=>x.id===id);if(p.stock<=0)return alert("Sin Stock");const e=carrito.find(x=>x.id===id);if(e)e.cantidad=fmtNum(e.cantidad+1);else carrito.push({...p,cantidad:1});renderCart()}function renderCart(){const l=document.getElementById('cart-list');if(!l)return;l.innerHTML=carrito.map((i,x)=>`<div class="bg-white p-3 rounded-2xl border flex justify-between items-center shadow-sm"><div class="font-black text-[10px] uppercase truncate w-24">${i.nombre}</div><div class="flex items-center gap-2"><input type="number" step="0.001" value="${fmtNum(i.cantidad)}" onchange="carrito[${x}].cantidad=fmtNum(this.value);renderCart()" class="input-cantidad"><span class="font-black text-sm">$${fmtNum(i.precio*i.cantidad)}</span><button onclick="carrito.splice(${x},1);renderCart()" class="text-red-300 text-xl"><i class="fas fa-times-circle"></i></button></div></div>`).join('');document.getElementById('total-txt').innerText=`$${fmtNum(carrito.reduce((s,i)=>s+(i.precio*i.cantidad),0))}`}function setMet(m){metodoActual=m;document.querySelectorAll('.btn-pago').forEach(b=>b.classList.remove('active-efectivo','active-transferencia','active-tarjeta','active-fiado'));document.getElementById(`btn-${m}`).classList.add(`active-${m.toLowerCase()}`);const fd=document.getElementById('fiado-nombre-div');if(m==='Fiado')fd.classList.remove('hidden');else fd.classList.add('hidden')}function cobrar(imp){if(!carrito.length)return;const t=carrito.reduce((s,i)=>s+(i.precio*i.cantidad),0);const pCon=parseFloat(document.getElementById('pago-con').value);let vuel=0;if(!isNaN(pCon)){if(pCon<t){alert("Monto insuficiente");return}vuel=pCon-t}let cli="";if(metodoActual==='Fiado'){cli=document.getElementById('fiado-cli').value.toUpperCase();if(!cli){alert("PONER NOMBRE");return}cuentasCorrientes[cli]=fmtNum((cuentasCorrientes[cli]||0)+t);localStorage.setItem('cuentas_corrientes',JSON.stringify(cuentasCorrientes))}historialVentas.push({id:Date.now(),fecha:new Date().toLocaleDateString(),hora:new Date().toLocaleTimeString(),total:t,ganancia:carrito.reduce((s,i)=>s+(i.precio-i.costo)*i.cantidad,0),metodo:metodoActual,cliente:cli,itemsDetallados:carrito.map(i=>({id:i.id,nombre:i.nombre,cantidad:i.cantidad,precio:i.precio,costo:i.costo}))});carrito.forEach(item=>{const p=productos.find(x=>x.id===item.id);if(p)p.stock=fmtNum(p.stock-item.cantidad)});localStorage.setItem('historial_ventas',JSON.stringify(historialVentas));localStorage.setItem('productos',JSON.stringify(productos));if(imp)imprimirTicket(t,cli,pCon,vuel);carrito=[];metodoActual="Efectivo";showSection('pos')}function imprimirTicket(t,cli,pCon,vuel){const w=window.open('','_blank');w.document.write(`<html><body style="font-family:sans-serif;width:230px;text-align:center;"><img src="${logoGuardado}" style="width:70px;height:70px;border-radius:50%;object-fit:cover;margin-bottom:5px;"><br><b style="font-size:14px;text-transform:uppercase;">${configNegocio.nombre}</b><hr><table style="width:100%;font-size:10px;text-align:left;">${carrito.map(i=>`<tr><td>${i.cantidad}</td><td>${i.nombre}</td><td>$${fmtNum(i.precio*i.cantidad)}</td></tr>`).join('')}</table><hr><b>TOTAL: $${fmtNum(t)}</b><br>${!isNaN(pCon)?`Paga con: $${fmtNum(pCon)}<br>Vuelto: $${fmtNum(vuel)}<br>`:''}<span style="font-size:10px;">${metodoActual} ${cli||''}</span><hr><div style="font-size:9px;">${configNegocio.tel?'Tel:'+configNegocio.tel:''}<br>${configNegocio.ig?'IG:'+configNegocio.ig:''}<br>${configNegocio.fb?'FB:'+configNegocio.fb:''}<br>¡GRACIAS!</div><script>window.print();window.close();<\/script></body></html>`)}function renderDailyTotals(c){const r=historialVentas.reduce((a,v)=>{if(!a[v.fecha])a[v.fecha]={bruto:0,efectivo:0};a[v.fecha].bruto+=v.total;if(v.metodo==='Efectivo')a[v.fecha].efectivo+=v.total;return a},{});const hoy=new Date().toLocaleDateString();if(!r[hoy])r[hoy]={bruto:0,efectivo:0};c.innerHTML=`<h2 class="text-3xl font-black text-blue-600 mb-8 uppercase italic">Caja Diaria</h2><div id="gasto-form" class="bg-orange-50 p-6 rounded-[2rem] mb-6 border-2 border-orange-200 hidden"><div class="grid grid-cols-2 gap-4"><input type="text" id="g-desc" placeholder="CONCEPTO GASTO" class="p-2 rounded-xl border text-center font-black uppercase"><input type="number" id="g-monto" placeholder="MONTO $" class="p-2 rounded-xl border text-center font-black"><button onclick="confirmarGasto()" class="col-span-2 bg-orange-500 text-white py-2 rounded-xl font-black uppercase">Guardar Gasto</button></div></div><div class="space-y-6">${Object.keys(r).reverse().map(f=>{const gl=gastos.filter(g=>g.fecha===f),tg=gl.reduce((s,g)=>s+g.monto,0),ci=cajasIniciales[f]||0;return `<div class="bg-white p-8 rounded-[3rem] border shadow-sm"><div class="flex justify-between border-b pb-3 mb-6 font-black text-blue-900"><span>${f}</span></div><div class="grid grid-cols-4 gap-4"><div><p class="text-[9px] font-black text-gray-400 uppercase">Caja Inicial</p><input type="number" value="${ci}" onchange="gCI('${f}',this.value)" class="w-20 text-center font-black bg-gray-50 border-2 rounded-xl py-1 outline-none"></div><div><p class="text-[9px] font-black text-gray-400 uppercase">Efectivo</p><p class="font-black text-xl text-gray-800">$${fmtNum(r[f].efectivo)}</p></div><div><p class="text-[9px] font-black text-orange-400 uppercase">Gastos</p><p class="font-black text-xl text-orange-500">$${tg}</p><button onclick="document.getElementById('gasto-form').classList.remove('hidden');window.targetFechaGasto='${f}'" class="text-[10px] font-black text-blue-500 underline uppercase mt-1 tracking-tighter font-black">+ GASTO</button></div><div class="text-right"><p class="text-[9px] font-black text-gray-400 uppercase font-black">Total Real</p><p class="font-black text-green-600 text-3xl font-black">$${fmtNum(ci+r[f].efectivo-tg)}</p></div></div><div class="mt-4 flex flex-wrap gap-2 justify-center text-[10px] font-bold">${gl.map(g=>`<span class="bg-orange-50 p-1 px-3 rounded-full border text-orange-800 font-bold">${g.desc}: $${g.monto} <i onclick="delG(${g.id})" class="fas fa-times-circle cursor-pointer ml-1 text-red-400"></i></span>`).join('')}</div></div>`}).join('')}</div>`}function confirmarGasto(){const d=document.getElementById('g-desc').value,m=parseFloat(document.getElementById('g-monto').value);if(d&&!isNaN(m)){gastos.push({id:Date.now(),fecha:window.targetFechaGasto,desc:d.toUpperCase(),monto:m});localStorage.setItem('gastos',JSON.stringify(gastos));showSection('totals')}}function delG(id){if(window.confirm("Borrar?")){gastos=gastos.filter(g=>g.id!==id);localStorage.setItem('gastos',JSON.stringify(gastos));showSection('totals')}}function gCI(f,v){cajasIniciales[f]=parseFloat(v)||0;localStorage.setItem('cajas_iniciales',JSON.stringify(cajasIniciales));showSection('totals')}function renderAccounts(c){c.innerHTML=`<h2 class="text-3xl font-black text-orange-500 mb-8 uppercase italic tracking-tighter text-center font-black">Cuentas Corrientes</h2><div class="grid grid-cols-3 gap-6">${Object.entries(cuentasCorrientes).map(([n,d])=>`<div class="bg-white p-8 rounded-[3rem] border shadow-sm text-center"><h3 class="font-black text-blue-900 text-xl uppercase font-black">${n}</h3><p class="text-4xl font-black text-red-600 mb-6">$${fmtNum(d)}</p><button onclick="payAcc('${n}')" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black uppercase tracking-widest text-xs shadow-md">Entrega Pago</button></div>`).join('')}</div>`}function payAcc(n){const p=parseFloat(window.prompt(`PAGA ${n}?`));if(!isNaN(p)){const f=new Date().toLocaleDateString();historialVentas.push({id:Date.now(),fecha:f,hora:new Date().toLocaleTimeString(),total:p,ganancia:p,metodo:'Efectivo',cliente:n+' (PAGO FIADO)',itemsDetallados:[]});cuentasCorrientes[n]=fmtNum(cuentasCorrientes[n]-p);if(cuentasCorrientes[n]<0)cuentasCorrientes[n]=0;localStorage.setItem('cuentas_corrientes',JSON.stringify(cuentasCorrientes));localStorage.setItem('historial_ventas',JSON.stringify(historialVentas));showSection('accounts')}}function renderInventory(c){c.innerHTML=`<div class="bg-white p-10 rounded-[3rem] mb-6 border text-center shadow-xl"><div class="flex flex-col items-center mb-4"><img src="${tempImgProd}" id="pre-img" class="w-20 h-20 rounded-xl object-cover bg-gray-50 mb-2 border shadow-inner"><label class="text-[10px] bg-blue-50 text-blue-600 px-4 py-1 rounded-full cursor-pointer font-black uppercase font-black">Foto Producto <input type="file" class="hidden" onchange="subirFotoProd(event)"></label></div><div class="grid grid-cols-5 gap-4"><input type="text" id="i-n" placeholder="NOMBRE" class="p-4 border-2 rounded-2xl text-center font-black uppercase outline-none focus:border-blue-400 font-bold"><input type="number" id="i-c" placeholder="COSTO" class="p-4 border-2 rounded-2xl text-center outline-none focus:border-blue-400 font-bold"><input type="number" id="i-p" placeholder="VENTA" class="p-4 border-2 rounded-2xl text-center outline-none focus:border-blue-400 font-bold"><input type="number" id="i-s" placeholder="STOCK" class="p-4 border-2 rounded-2xl text-center outline-none focus:border-blue-400 font-bold"><button onclick="saveP()" class="bg-blue-600 text-white rounded-2xl font-black uppercase text-xs shadow-md font-black">Guardar</button></div></div><div class="mb-4 flex justify-center"><div class="relative w-full max-w-md"><i class="fas fa-search absolute left-4 top-4 text-gray-400"></i><input type="text" id="inv-bus" oninput="filtroInv=this.value.toLowerCase();actualizarTablaInv()" placeholder="Buscar en inventario..." class="w-full p-4 pl-12 border-2 rounded-2xl font-bold bg-white outline-none focus:border-blue-400 uppercase shadow-sm" value="${filtroInv}"></div></div><div id="lista-inv" class="space-y-2 pb-10"></div>`;actualizarTablaInv()}function actualizarTablaInv(){const fInv=productos.filter(p=>p.nombre.toLowerCase().includes(filtroInv));const l=document.getElementById('lista-inv');if(!l)return;l.innerHTML=fInv.map((p,idx)=>{const ri=productos.findIndex(x=>x.id===p.id);return `<div class="bg-white p-4 rounded-2xl border flex justify-between items-center text-center shadow-sm"><div class="flex items-center gap-4 w-1/3 text-left pl-2"><img src="${p.img||''}" class="w-12 h-12 rounded-lg object-cover bg-gray-50 border shadow-inner"><div class="uppercase font-black truncate text-sm font-bold text-gray-700">${p.nombre}</div></div><div class="flex gap-4 items-center"><input type="number" id="c-${p.id}" value="${p.costo}" oninput="showTilde('${p.id}')" class="w-20 text-center bg-orange-50 rounded-lg font-black p-2 outline-none"><input type="number" id="p-${p.id}" value="${p.precio}" oninput="showTilde('${p.id}')" class="w-20 text-center bg-blue-50 rounded-lg font-black p-2 outline-none"><input type="number" id="s-${p.id}" value="${p.stock}" oninput="showTilde('${p.id}')" class="w-20 text-center bg-gray-50 rounded-lg font-black p-2 outline-none"><button id="ok-${p.id}" onclick="saveRow('${p.id}',${ri})" class="hidden text-green-500 text-3xl animate-pulse"><i class="fas fa-check-circle"></i></button><button onclick="delP(${ri})" class="text-red-200 text-2xl ml-4 hover:text-red-500"><i class="fas fa-trash"></i></button></div></div>`}).join('')}function subirFotoProd(ev){const f=ev.target.files[0];if(f){const r=new FileReader();r.onload=(e)=>{tempImgProd=e.target.result;document.getElementById('pre-img').src=tempImgProd};r.readAsDataURL(f)}}function showTilde(id){document.getElementById('ok-'+id).classList.remove('hidden')}function saveRow(id,ri){productos[ri].costo=document.getElementById('c-'+id).value;productos[ri].precio=document.getElementById('p-'+id).value;productos[ri].stock=document.getElementById('s-'+id).value;localStorage.setItem('productos',JSON.stringify(productos));document.getElementById('ok-'+id).classList.add('hidden')}function delP(ri){if(window.confirm("Borrar?")){productos.splice(ri,1);localStorage.setItem('productos',JSON.stringify(productos));showSection('inventory')}}function saveP(){const n=document.getElementById('i-n').value,c=parseFloat(document.getElementById('i-c').value)||0,p=parseFloat(document.getElementById('i-p').value)||0,s=parseFloat(document.getElementById('i-s').value)||0;if(n){productos.push({id:Date.now(),nombre:n.toUpperCase(),costo:c,precio:p,stock:s,img:tempImgProd});localStorage.setItem('productos',JSON.stringify(productos));tempImgProd="";showSection('inventory')}}function renderGanancias(c){const r=historialVentas.reduce((a,v)=>{if(!a[v.fecha])a[v.fecha]=0;a[v.fecha]+=v.ganancia;return a},{});const hoy=new Date().toLocaleDateString(),gHoy=r[hoy]||0,gSem=Object.values(r).slice(0,7).reduce((s,v)=>s+v,0);c.innerHTML=`<h2 class="text-3xl font-black text-green-600 mb-8 uppercase italic tracking-tighter text-center">Ganancias Reales</h2><div class="grid grid-cols-2 gap-6"><div class="bg-white p-10 rounded-[3rem] border shadow-xl text-center"><p class="text-gray-400 font-black uppercase text-xs font-black">Ganancia de Hoy</p><p class="text-5xl font-black text-green-600 mt-2 font-black tracking-tighter">$${fmtNum(gHoy)}</p></div><div class="bg-white p-10 rounded-[3rem] border shadow-xl text-center"><p class="text-gray-400 font-black uppercase text-xs font-black">Ganancia 7 Días</p><p class="text-5xl font-black text-blue-600 mt-2 font-black tracking-tighter font-black">$${fmtNum(gSem)}</p></div></div><div class="mt-10 bg-white p-8 rounded-[3rem] border shadow-sm text-center"><h3 class="font-black uppercase italic border-b pb-4 mb-4 text-center font-black">Historial Neto</h3><div class="space-y-2 text-center">${Object.keys(r).reverse().map(f=>`<div class="flex justify-between font-bold px-10"><span>${f}</span><span class="text-green-600 font-black text-lg">$${fmtNum(r[f])}</span></div>`).join('')}</div></div>`}function renderReports(c){const dh=historialVentas.filter(v=>v.fecha===new Date().toLocaleDateString());c.innerHTML=`<h2 class="text-3xl font-black text-blue-600 mb-8 uppercase italic text-center tracking-tighter font-black font-black">Auditoría Hoy</h2><div class="space-y-3 pb-10">${dh.slice().reverse().map(v=>`<div class="p-5 rounded-[2rem] border-2 flex justify-between bg-white items-center text-left shadow-sm"><div class="pl-4"><p class="font-black text-sm text-gray-700 font-black">${v.hora} - ${v.metodo} ${v.cliente?`(${v.cliente})`:''}</p><p class="text-[11px] font-bold text-blue-600 italic uppercase">${v.itemsDetallados?v.itemsDetallados.map(i=>`${fmtNum(i.cantidad)}x ${i.nombre}`).join(' | '):''}</p></div><div class="flex items-center gap-6"><span class="font-black text-2xl text-gray-800 font-black tracking-tighter">$${fmtNum(v.total)}</span><button onclick="anulV(${v.id})" class="text-red-300 text-2xl hover:text-red-600"><i class="fas fa-trash-alt"></i></button></div></div>`).join('')}</div>`}function anulV(id){if(window.confirm("Anular venta?")){const v=historialVentas.find(x=>x.id===id);if(v.metodo==='Fiado')cuentasCorrientes[v.cliente]-=v.total;v.itemsDetallados.forEach(i=>{const p=productos.find(x=>x.id===i.id);if(p)p.stock=fmtNum(p.stock+i.cantidad)});historialVentas=historialVentas.filter(x=>x.id!==id);localStorage.setItem('historial_ventas',JSON.stringify(historialVentas));localStorage.setItem('productos',JSON.stringify(productos));showSection('reports')}}function renderConfig(c){c.innerHTML=`<div class="max-w-2xl mx-auto bg-white p-12 rounded-[3.5rem] border text-center shadow-xl font-black"><h2 class="text-3xl font-black uppercase mb-10 text-blue-600 italic leading-tight tracking-tighter">CONFIGURACIÓN</h2><div class="space-y-6"><div class="flex flex-col items-center gap-4"><img src="${logoGuardado}" id="config-img" class="w-32 h-32 rounded-full border shadow-md object-cover"><label class="bg-blue-50 text-blue-600 px-6 py-2 rounded-full font-black text-[10px] cursor-pointer uppercase hover:bg-blue-100">Cambiar Perfil<input type="file" class="hidden" onchange="subirFoto(event)"></label></div><input type="text" id="cfg-n" value="${configNegocio.nombre}" class="w-full p-4 border-2 rounded-2xl text-center font-black uppercase"><div class="grid grid-cols-2 gap-4"><input type="text" id="cfg-d1" value="${configNegocio.dir1}" class="p-4 border-2 rounded-2xl text-center font-black uppercase"><input type="text" id="cfg-d2" value="${configNegocio.dir2}" class="p-4 border-2 rounded-2xl text-center font-black uppercase"></div><button onclick="saveCfg()" class="w-full bg-blue-600 text-white py-5 rounded-[2rem] font-black uppercase shadow-lg text-xs font-black">Guardar</button><button onclick="expDat()" class="bg-gray-800 text-white w-full py-4 rounded-2xl uppercase font-black text-[10px] font-black tracking-widest">Respaldo Datos</button></div></div>`}function subirFoto(ev){const f=ev.target.files[0];if(f){const r=new FileReader();r.onload=(e)=>{logoGuardado=e.target.result;localStorage.setItem('app_logo_base64',logoGuardado);document.getElementById('config-img').src=logoGuardado;document.getElementById('app-logo').src=logoGuardado};r.readAsDataURL(f)}}function saveCfg(){configNegocio={nombre:document.getElementById('cfg-n').value.toUpperCase(),dir1:document.getElementById('cfg-d1').value,dir2:document.getElementById('cfg-d2').value,tel:"",ig:"",fb:""};localStorage.setItem('config_negocio',JSON.stringify(configNegocio));location.reload()}function expDat(){const b=new Blob([JSON.stringify({productos,historialVentas,gastos,cajasIniciales,cuentasCorrientes,configNegocio,logo:logoGuardado})],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download=`Repostero_Backup.json`;a.click()}function filtrarProductos(){filtroActual=document.getElementById('buscador').value.toLowerCase();actualizarVentas()}function renderWeeklyRanking(c){const a=historialVentas.reduce((acc,v)=>{if(!acc[v.fecha])acc[v.fecha]={};if(v.itemsDetallados){v.itemsDetallados.forEach(i=>{if(!acc[v.fecha][i.nombre])acc[v.fecha][i.nombre]=0;acc[v.fecha][i.nombre]=fmtNum(acc[v.fecha][i.nombre]+i.cantidad)});}return acc},{});const fs=Object.keys(a).sort((x,y)=>new Date(y)-new Date(x)).slice(0,7);c.innerHTML=`<h2 class="text-3xl font-black text-blue-600 mb-8 uppercase italic text-center tracking-tighter">Ranking Semanal</h2><div class="space-y-6">${fs.map(f=>`<div class="bg-white p-8 rounded-[3rem] border shadow-sm"><h3 class="font-black border-b mb-4 uppercase italic text-blue-900">${f}</h3><div class="grid grid-cols-4 gap-4">${Object.entries(a[f]).sort((x,y)=>y[1]-x[1]).map(([n,q])=>`<div class="bg-gray-50 p-4 rounded-2xl border text-center shadow-inner"><p class="text-[9px] font-black text-gray-400 uppercase truncate">${n}</p><p class="text-xl font-black text-gray-800 font-black">${q}</p></div>`).join('')}</div></div>`).join('')}</div>`}function renderPedidos(c){c.innerHTML=`<div class="max-w-4xl mx-auto"><div class="bg-white p-10 rounded-[3rem] mb-10 border shadow-xl"><h2 class="text-2xl font-black text-blue-600 mb-6 uppercase italic text-center tracking-tighter">Nuevo Pedido</h2><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><input type="text" id="p-cli" placeholder="CLIENTE" class="p-4 border-2 rounded-2xl font-black uppercase text-center outline-none focus:border-blue-400"><input type="date" id="p-fec" class="p-4 border-2 rounded-2xl font-black text-center outline-none focus:border-blue-400"></div><textarea id="p-det" placeholder="PRODUCTOS Y CANTIDAD" class="w-full p-4 border-2 rounded-2xl font-black uppercase text-center h-24 mb-4 outline-none focus:border-blue-400"></textarea><button onclick="savePedido()" class="w-full bg-blue-600 text-white py-5 rounded-[2rem] font-black uppercase shadow-lg text-xs">Confirmar</button></div><div id="lista-pedidos" class="space-y-4">${pedidos.map((p,idx)=>`<div class="bg-white p-6 rounded-[2rem] border shadow-sm flex justify-between items-center"><div class="text-left pl-6"><p class="text-[10px] font-black text-purple-500 uppercase italic">Entrega: ${p.fecha}</p><p class="text-xl font-black uppercase text-gray-800">${p.cliente}</p><p class="text-sm font-bold text-gray-600 uppercase italic leading-relaxed">${p.detalle}</p></div><button onclick="borrarPedido(${idx})" class="text-green-400 hover:text-green-600 text-3xl transition mr-6"><i class="fas fa-check-circle"></i></button></div>`).join('')}</div></div>`}function savePedido(){const c=document.getElementById('p-cli').value,f=document.getElementById('p-fec').value,d=document.getElementById('p-det').value;if(c&&f&&d){pedidos.push({cliente:c.toUpperCase(),fecha:f,detalle:d.toUpperCase()});pedidos.sort((a,b)=>new Date(a.fecha)-new Date(b.fecha));localStorage.setItem('pedidos_repostero',JSON.stringify(pedidos));showSection('pedidos')}}function borrarPedido(i){if(window.confirm("¿Entregado?")){pedidos.splice(i,1);localStorage.setItem('pedidos_repostero',JSON.stringify(pedidos));showSection('pedidos')}}setInterval(()=>document.getElementById('reloj').innerText=new Date().toLocaleString(),1000);</script></body></html>
